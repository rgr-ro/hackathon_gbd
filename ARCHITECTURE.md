# Pipeline de Datos - Arquitectura del Sistema

## ðŸ—ï¸ Arquitectura General

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                         FUENTE DE DATOS                              â”‚
â”‚                   Datos Abiertos UAM (2017-2025)                     â”‚
â”‚              https://datos.uam.es/sites/default/files/               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                             â”‚
                             â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    SERVICIO: descarga_datos                          â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”‚
â”‚  â”‚ â€¢ Descarga automÃ¡tica de ~50 CSVs                          â”‚     â”‚
â”‚  â”‚ â€¢ Presupuestos: gastos (14) + ingresos (14)                â”‚     â”‚
â”‚  â”‚ â€¢ Licitaciones: 8 archivos                                 â”‚     â”‚
â”‚  â”‚ â€¢ Ayudas: convocatorias (7) + concedidas (7)               â”‚     â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                 â”‚                            â”‚
                 â–¼                            â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  SERVICIO: load_data       â”‚   â”‚  SERVICIO: create_graph          â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚   â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚ CSV â†’ PostgreSQL     â”‚  â”‚   â”‚  â”‚ CSV â†’ RDF/TTL              â”‚ â”‚
â”‚  â”‚ â€¢ NormalizaciÃ³n      â”‚  â”‚   â”‚  â”‚ â€¢ OntologÃ­a personalizada â”‚ â”‚
â”‚  â”‚ â€¢ ValidaciÃ³n FK      â”‚  â”‚   â”‚  â”‚ â€¢ Metadatos DCAT          â”‚ â”‚
â”‚  â”‚ â€¢ DeduplicaciÃ³n      â”‚  â”‚   â”‚  â”‚ â€¢ Enlaces externos        â”‚ â”‚
â”‚  â”‚ â€¢ ~145K registros    â”‚  â”‚   â”‚  â”‚   (DBpedia, Wikidata)     â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚   â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
             â”‚                                  â”‚
             â–¼                                  â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   PostgreSQL 16 + pgVector â”‚   â”‚    data/ttl/grafo_completo.ttl   â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚   â”‚    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚   â”‚ TABLAS:              â”‚ â”‚   â”‚    â”‚ Volumen compartido       â”‚ â”‚
â”‚   â”‚ â€¢ universidad        â”‚ â”‚   â”‚    â”‚ Montado en GraphDB       â”‚ â”‚
â”‚   â”‚ â€¢ presupuesto_gastos â”‚ â”‚   â”‚    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚   â”‚ â€¢ presupuesto_ingresosâ”‚ â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
â”‚   â”‚ â€¢ convocatoria_ayuda â”‚ â”‚                   â”‚
â”‚   â”‚ â€¢ ayuda              â”‚ â”‚                   â–¼
â”‚   â”‚ â€¢ licitacion         â”‚ â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚   â”‚ SERVICIO: upload_to_graphdb  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
             â”‚                   â”‚ â”‚ â€¢ Espera GraphDB         â”‚ â”‚
             â”‚                   â”‚ â”‚ â€¢ Crea repositorio       â”‚ â”‚
             â”‚                   â”‚ â”‚ â€¢ Sube TTL vÃ­a REST API  â”‚ â”‚
             â”‚                   â”‚ â”‚ â€¢ ~75K triples           â”‚ â”‚
             â”‚                   â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
             â”‚                   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
             â”‚                                  â–¼
             â”‚                   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
             â”‚                   â”‚       GraphDB 10.3.2             â”‚
             â”‚                   â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
             â”‚                   â”‚   â”‚ Repositorio: uam_data      â”‚ â”‚
             â”‚                   â”‚   â”‚ Puerto: 8000               â”‚ â”‚
             â”‚                   â”‚   â”‚ SPARQL Endpoint disponible â”‚ â”‚
             â”‚                   â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
             â”‚                   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
             â”‚                                  â”‚
             â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                            â”‚
                            â–¼
           â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
           â”‚     demo/presentacion.ipynb            â”‚
           â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
           â”‚  â”‚ Jupyter Notebook                 â”‚  â”‚
           â”‚  â”‚ â€¢ Consultas SQL a PostgreSQL     â”‚  â”‚
           â”‚  â”‚ â€¢ Consultas SPARQL a GraphDB     â”‚  â”‚
           â”‚  â”‚ â€¢ Visualizaciones (matplotlib)   â”‚  â”‚
           â”‚  â”‚ â€¢ ComparaciÃ³n SQL vs SPARQL      â”‚  â”‚
           â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
           â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## ðŸ“¦ VolÃºmenes Compartidos

```
hackathon_gbd/
â”œâ”€â”€ data/
â”‚   â”œâ”€â”€ csv/all_csv/          â† descarga_datos (W) â†’ load_data (R), create_graph (R)
â”‚   â””â”€â”€ ttl/                  â† create_graph (W) â†’ upload_to_graphdb (R)
â”‚       â””â”€â”€ grafo_completo.ttl
```

## ðŸ”„ Flujo de EjecuciÃ³n

```
1. docker compose up descarga_datos
   â””â”€> Descarga ~50 CSVs a data/csv/all_csv/

2. docker compose up load_data
   â””â”€> Lee CSVs desde data/csv/all_csv/
   â””â”€> Carga a PostgreSQL (145K+ registros)

3. docker compose up create_graph
   â””â”€> Lee CSVs desde data/csv/all_csv/
   â””â”€> Genera data/ttl/grafo_completo.ttl

4. docker compose up upload_to_graphdb
   â””â”€> Espera a que GraphDB estÃ© disponible
   â””â”€> Crea repositorio 'uam_data'
   â””â”€> Sube data/ttl/grafo_completo.ttl vÃ­a REST API
   â””â”€> ~75K triples cargados

5. jupyter notebook demo/presentacion.ipynb
   â””â”€> Conecta a PostgreSQL (puerto 5432)
   â””â”€> Conecta a GraphDB (puerto 8000)
   â””â”€> Ejecuta consultas SQL y SPARQL
```

## ðŸŽ¯ Servicios y Dependencias

```
db (PostgreSQL)
  â””â”€> load_data (depende de db + descarga_datos)

descarga_datos (standalone)
  â”œâ”€> load_data (depende de descarga_datos)
  â””â”€> create_graph (depende de descarga_datos)

create_graph (standalone despuÃ©s de descarga_datos)
  â””â”€> upload_to_graphdb (depende de create_graph + graphdb)

graphdb (standalone)
  â””â”€> upload_to_graphdb (depende de graphdb)

pgadmin
  â””â”€> Interfaz web para db
```

## ðŸ“Š EstadÃ­sticas

- **CSVs procesados**: ~50 archivos (2017-2025)
- **Registros en PostgreSQL**: ~145,000
  - Presupuestos gastos: ~115,000
  - Presupuestos ingresos: ~18,000
  - Ayudas: ~10,000
  - Licitaciones: ~500
  - Convocatorias: ~100
- **TamaÃ±o del grafo TTL**: ~5-10 MB (depende de los datos)
- **Triples RDF**: ~50,000-100,000 (aproximado)

## ðŸ”— Integraciones

### PostgreSQL â†” Jupyter Notebook

- Protocolo: psycopg2
- Puerto: 5432
- Queries: SQL estÃ¡ndar

### GraphDB â†” Jupyter Notebook

- Protocolo: SPARQLWrapper (HTTP)
- Puerto: 8000
- Endpoint: `/repositories/uam_data`
- Queries: SPARQL 1.1

### Enlaces Externos (desde RDF)

- DBpedia: http://dbpedia.org/resource/Autonomous_University_of_Madrid
- Wikidata: http://www.wikidata.org/entity/Q233939
- Schema.org: Vocabulario estÃ¡ndar para entidades
